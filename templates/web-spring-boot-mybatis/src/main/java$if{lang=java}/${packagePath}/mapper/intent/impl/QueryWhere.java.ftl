/*  This class is generated by CodeMan */package ${packageName}.mapper.intent.impl;import ${packageName}.mapper.intent.api.OrderQuery;import ${packageName}.mapper.intent.api.WhereQuery;import java.util.ArrayList;import java.util.Arrays;import java.util.List;public class QueryWhere<T> extends WhereItem<T> implements WhereQuery<T> {    private int level = 0;    private List<WhereQuery<T>> wheres;    public QueryWhere(WhereQuery<T> where) {        if (where instanceof QueryWhere) {            this.op = ((QueryWhere<T>) where).op;            this.column = ((QueryWhere<T>) where).column;            this.value = ((QueryWhere<T>) where).value;            this.level = ((QueryWhere<T>) where).level;            this.wheres = ((QueryWhere<T>) where).wheres;        } else {            this.wheres = where.getWheres();        }    }    public QueryWhere(QueryWhere<T> where) {        super(where);        this.level = where.level;        this.wheres = where.wheres;    }    public QueryWhere(String column, String op, Object value) {        this.op = op;        this.value = value;        this.column = column;    }    public QueryWhere(QueryWhere<T> left, String op, QueryWhere<T> right) {        this.op = op;        this.level = Math.max(left.level, right.level) + 1;        this.wheres = new ArrayList<>(Arrays.asList(left, right));        this.checkLevel();    }    @Override    @SafeVarargs    public final OrderQuery<T> orderBy(OrderQuery<T>... order) {        return new OrderWhere<T>(this).orderBy(order);    }    public boolean isMultCondition() {        return wheres != null;    }    public WhereQuery<T> or(WhereQuery<T> where) {        if (where instanceof QueryWhere ) {            return merge(this, "OR", (QueryWhere<T>)where);        }        return this;    }    public WhereQuery<T> and(WhereQuery<T> where) {        if (where instanceof QueryWhere ) {            return merge(this, "AND", (QueryWhere<T>)where);        }        return this;    }    private static <T> QueryWhere<T> merge(QueryWhere<T> left, String op, QueryWhere<T> right) {        if (left.isMultCondition() != right.isMultCondition()) {            if (left.isMultCondition()) {                return left.annex(right, op);            } else {                return right.annex(left, op);            }        } else if (left.isMultCondition() && right.isMultCondition()) {            if (op.equals(left.op)) {                return left.annex(right, op);            } else if (op.equals(right.op)) {                return right.annex(left, op);            } else {                return new QueryWhere<>(left, op, right);            }        }        return new QueryWhere<>(left, op, right);    }    private QueryWhere<T> annex(QueryWhere<T> where, String op) {        if (wheres == null) {            throw new RuntimeException("annex(QueryWhere,op)函数中，叶级别无法吞并！");        }        if (op.equals(this.op)) {            if (where.isMultCondition() && op.equals(where.op)) {                if (this.level < where.level) {                    this.level = where.level + 1;                }                this.wheres.addAll(where.wheres);            } else {                if (this.level <= where.level) {                    this.level = where.level + 1;                }                this.wheres.add(where);            }            this.checkLevel();            return this;        } else {            return new QueryWhere<>(this, op, where);        }    }    private void checkLevel() {        if (this.level > 3) {            throw new RuntimeException("checkLevel() = " + level + ", 不能超过2！");        }    }    public String getOp() {        return op;    }    public void setOp(String op) {        this.op = op;    }    public String getColumn() {        return column;    }    public void setColumn(String column) {        this.column = column;    }    public Object getValue() {        return value;    }    public void setValue(Object value) {        this.value = value;    }    public List<WhereQuery<T>> getWheres() {        return wheres;    }    public void setWheres(List<WhereQuery<T>> wheres) {        this.wheres = wheres;    }}